(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{"./src/handlers/TopicHandler.tsx":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),o=n.n(r),i=n("./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js"),a=n.n(i),l=n("./node_modules/lodash/cloneDeep.js"),s=n.n(l),c=n("./node_modules/graphql-tag/src/index.js"),p=n.n(c),u=n("./node_modules/react/index.js"),m=n("./node_modules/@apollo/react-components/lib/react-components.esm.js"),d=n("./node_modules/react-redux/es/index.js"),g=n("./src/apollo/error.ts"),f=n("./src/components/navigation/Redirect.tsx"),E=n("./src/components/post-listing/index.ts"),b=n("./src/components/session/WithViewer.tsx"),v=n("./src/screens/ErrorScreen.tsx"),w=n("./src/screens/LoadingScreen.tsx"),x=n("./src/screens/NotFoundScreen.tsx"),T=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),h=n.n(T),P=n("./node_modules/@babel/runtime/helpers/createClass.js"),y=n.n(P),_=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),L=n.n(_),S=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),I=n.n(S),k=n("./node_modules/@babel/runtime/helpers/inherits.js"),F=n.n(k),O=n("./src/components/analytics/ParselyReporter.tsx"),j=n("./src/components/metabar/Metabar.tsx"),B=n("./src/components/post/helpers/loggedOutHistory.ts"),R=n("./src/framework/design-system/components/index.ts"),A=n("./src/framework/design-system/type/index.ts"),M=n("./src/framework/style/index.ts"),W=n("./src/util/post/titleHelpers.ts"),C=n("./src/util/routes.ts");function D(){var e=a()(["\n  fragment FeaturedPostPreview_post on Post {\n    id\n    title\n    mediumUrl\n    previewContent {\n      subtitle\n      isFullContent\n    }\n  }\n"]);return D=function(){return e},e}var U={wordBreak:"break-word",wordWrap:"break-word"},N=function(e){var t=e.post,n=Object(M.useCx)();return u.createElement("div",{className:n(U)},u.createElement(R.m,{clamp:2},u.createElement(R.f,{href:Object(C.kb)(t)},Object(W.b)(t.title))),t.previewContent&&t.previewContent.subtitle&&u.createElement(R.b,{marginTop:"4px"},u.createElement(R.A,{ui:"REGULAR"},u.createElement(A.f,{scale:"M",clamp:2},u.createElement(R.f,{href:Object(C.kb)(t)},t.previewContent.subtitle)))))},H=p()(D()),$=n("./src/components/post-listing/PostListingItemBylineWithAvatar.tsx"),G=n("./src/components/post-listing/PostListingItemImage.tsx"),z=n("./src/components/post-listing/PostListingItemPreview.tsx"),q=n("./src/framework/source/index.ts"),V=n("./src/framework/track/index.ts");function J(){var e=a()(["\n  fragment TopicLandingFeaturedStory_post on Post {\n    ...FeaturedPostPreview_post\n    ...PostListingItemPreview_post\n    ...PostListingItemBylineWithAvatar_post\n    ...PostListingItemImage_post\n    ...PostPresentationTracker_post\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return J=function(){return e},e}var Q=function(e){return Boolean(e.previewImage&&e.previewImage.id)};function X(e){var t=e.post;return u.createElement(q.b,{source:{name:"topic_page",sectionType:q.a.FEATURED_STORIES}},u.createElement(V.b,{post:t,presentationContext:"POST_PREVIEW"},Q(t)&&u.createElement(u.Fragment,null,u.createElement(R.b,{display:"none",sm:{display:"block",marginLeft:"-24px",marginRight:"-24px",marginTop:"0px"}},u.createElement(G.b,{post:t,width:"100%",miroWidth:680,miroHeight:320})),u.createElement(R.b,{marginTop:"0px",display:"block",sm:{display:"none"}},u.createElement(G.b,{post:t,width:"100%",miroWidth:680,miroHeight:382}))),u.createElement(R.b,{marginTop:"13px",md:{display:"none"}},u.createElement(R.A,{ui:"LARGE"},u.createElement(N,{post:t}))),u.createElement(R.b,{marginTop:"21px",display:"none",md:{display:"block"}},u.createElement(R.A,{ui:"REGULAR"},u.createElement(z.a,{post:t}))),u.createElement(R.b,{marginTop:"16px"},u.createElement($.b,{post:t,showBookmark:!1}))))}var Y=p()(J(),H,z.b,$.a,G.a,V.c);function K(e){var t=e.feedItems;return u.createElement(u.Fragment,null,u.createElement(R.r,{tag:"h2"},"Latest"),u.createElement(R.b,{paddingTop:"12px",paddingBottom:"12px"},t))}var Z=n("./src/components/post-listing/PostListingItemFeaturedWriter.tsx"),ee=function(e){var t=e.previews;if(!t||!t.length)return null;var n=t.slice(0,3);return u.createElement(u.Fragment,null,n.map((function(e,t){var r=t===n.length-1;return u.createElement(R.b,{marginBottom:r?"0px":"10px",key:e.postId||void 0},u.createElement(q.b,{source:{name:"topic_page",index:t,sectionType:q.a.FEATURED_WRITER}},u.createElement(Z.b,{postPreview:e})))})))},te=n("./src/components/user/UserAvatar.tsx"),ne=n("./src/components/user/UserFollowButton.tsx");function re(){var e=a()(["\n  fragment FeaturedWriter_featuredTopicWriter on FeaturedTopicWriter {\n    user {\n      id\n      username\n      name\n      bio\n      ...UserAvatar_user\n      ...UserFollowButton_user\n    }\n    posts {\n      postPreviews {\n        ...PostListingItemFeaturedWriter_postPreview\n      }\n    }\n  }\n  ","\n  ","\n  ","\n"]);return re=function(){return e},e}function oe(){var e=a()(["\n  fragment FeaturedWriter_viewer on User {\n    id\n  }\n"]);return oe=function(){return e},e}function ie(e){var t=e.writer;if(!t||!t.user)return null;var n=t.user,r=t.posts&&t.posts.postPreviews||[];return u.createElement(b.b,null,(function(e){return u.createElement(R.A,{ui:"SMALL"},u.createElement(R.b,{backgroundColor:"BASE_NORMAL",padding:"24px 40px",minWidth:"60%",sm:{padding:"24px"}},u.createElement(R.b,{marginBottom:"24px"},u.createElement(R.q,{tag:"h2",strong:!0},"Featured Writer")),u.createElement(R.b,{display:"flex",sm:{flexDirection:"column"}},u.createElement(R.b,{flexGrow:"1",flexShrink:"1",display:"flex",sm:{display:"flex",alignItems:"center"}},u.createElement(R.b,{flexGrow:"0",flexShrink:"0",display:"flex",flexDirection:"column",alignItems:"center"},u.createElement(R.b,{sm:{display:"none"}},u.createElement(te.d,{withHalo:!1,user:n,scale:"XXL",link:!0})),u.createElement(R.b,{display:"none",sm:{display:"block"}},u.createElement(te.d,{withHalo:!1,user:n,scale:"L",link:!0})),(!e||e.id!==n.id)&&u.createElement(R.b,{marginTop:"16px",sm:{display:"none"}},u.createElement(q.b,{source:{susiEntry:"follow_topicfeatured"},extendSource:!0},u.createElement(ne.c,{user:n,buttonSize:"SMALL",buttonStyleFn:function(e){return e?"BRAND":"SUBTLE"}})))),u.createElement(R.b,{flexGrow:"1",flexShrink:"1",marginLeft:"24px",sm:{marginLeft:"16px"}},n.name&&u.createElement(R.o,{strong:!0},n.username?u.createElement(R.u,{href:Object(C.Ub)(n.username||""),inline:!0},n.name):n.name),n.bio&&u.createElement(R.b,{marginTop:"8px",sm:{display:"none"}},u.createElement(A.f,{scale:"S",clamp:7},n.bio))),(!e||e.id!==n.id)&&u.createElement(R.b,{display:"none",flexGrow:"0",flexShrink:"0",sm:{display:"block",marginLeft:"16px"}},u.createElement(q.b,{source:{susiEntry:"follow_topicfeatured"},extendSource:!0},u.createElement(ne.c,{user:n,buttonSize:"SMALL",buttonStyleFn:function(e){return e?"BRAND":"SUBTLE"}})))),n.bio&&u.createElement(R.b,{display:"none",sm:{display:"block",marginTop:"12px"}},u.createElement(A.f,{scale:"S",clamp:7},n.bio)),r.length>0&&u.createElement(R.b,{flexGrow:"1",flexShrink:"1",marginLeft:"24px",minWidth:"40%",sm:{marginTop:"16px",marginLeft:"0px",width:"100%"}},u.createElement(ee,{previews:r})))))}))}p()(oe());var ae=p()(re(),te.b,ne.b,E.a),le=n("./src/components/ui/InfiniteScrollTrigger.tsx");function se(){var e=a()(["\n  fragment TopicFeaturedAndLatest_topic on Topic {\n    featuredPosts {\n      postPreviews {\n        post {\n          id\n          ...TopicLandingFeaturedStory_post\n        }\n      }\n    }\n    featuredTopicWriters(limit: 1) {\n      ...FeaturedWriter_featuredTopicWriter\n    }\n    # $feedPagingOptions is declared in TopicHandler; when GraphQL# supports\n    # parameterized fragments, we should make this dependency explicit.\n    latestPosts(paging: $feedPagingOptions) {\n      postPreviews {\n        post {\n          id\n        }\n        ...PostListingItemFeed_postPreview\n      }\n      pagingInfo {\n        next {\n          limit\n          to\n        }\n      }\n    }\n  }\n  ","\n  ","\n  ","\n"]);return se=function(){return e},e}var ce=function(e,t){var n,r=e&&e.featuredTopicWriters&&e.featuredTopicWriters[0],o=r?(n=r,u.createElement(R.b,{marginTop:"32px",marginBottom:"32px",marginLeft:"-40px",lg:{marginLeft:"0px"}},u.createElement(ie,{writer:n}))):null,i=e.latestPosts?e.latestPosts.postPreviews:[];if(0===i.length)return[];var a=i.map((function(e){return t&&e.post&&e.post.id===t?null:{preview:e}})).filter(Boolean),l=a.slice(0,3),s=a.slice(3,i.length);return l.concat({chunk:o},s)},pe=function(e){return e&&e.latestPosts&&e.latestPosts.postPreviews&&e.latestPosts.postPreviews.length>0},ue=function(e){var t=e&&e.featuredPosts&&e.featuredPosts.postPreviews&&e.featuredPosts.postPreviews.length>0&&e.featuredPosts.postPreviews[0]||null;return t&&t.post?t.post:null};function me(e){var t=e.topic,n=e.loading,r=e.fetchMore,o=ue(t)||null,i=o?o.id:null,a=pe(t)&&ce(t,i).map((function(e,t){var n=e.chunk,r=e.preview;return n?u.createElement(u.Fragment,{key:t},n):r&&r.post?u.createElement(R.B,{key:r.post.id,gutter:!1},u.createElement(q.b,{source:{name:"topic_page",index:t,sectionType:q.a.NONE}},u.createElement(E.b,{postPreview:r}))):null}))||[];return u.createElement(u.Fragment,null,o&&u.createElement(R.b,{marginBottom:"40px",sm:{marginBottom:"24px"}},u.createElement(X,{post:o})),pe&&u.createElement(le.a,{fetchMore:n?null:r},u.createElement(K,{feedItems:a})))}var de=p()(se(),Y,ae,E.c),ge=n("./node_modules/lodash/flowRight.js"),fe=n.n(ge),Ee=n("./node_modules/@apollo/react-hoc/lib/react-hoc.esm.js");function be(){var e=a()(["\n  mutation unfollowTopic($slug: ID!) {\n    unfollowTopic(slug: $slug) {\n      slug\n      isFollowing\n    }\n  }\n"]);return be=function(){return e},e}function ve(){var e=a()(["\n  mutation followTopic($slug: ID!) {\n    followTopic(slug: $slug) {\n      slug\n      isFollowing\n    }\n  }\n"]);return ve=function(){return e},e}function we(){var e=a()(["\n  fragment TopicFollowButtonSignedIn_topic on Topic {\n    slug\n    isFollowing\n  }\n"]);return we=function(){return e},e}var xe=p()(we()),Te=p()(ve()),he=p()(be()),Pe=fe()(Object(Ee.a)(Te,{name:"followTopic",props:function(e){var t=e.ownProps,n=e.followTopic;return{followTopic:function(){n({variables:{slug:t.topic.slug},optimisticResponse:{__typename:"Mutation",followTopic:{__typename:"Topic",isFollowing:!0,slug:t.topic.slug}}})}}}}),Object(Ee.a)(he,{name:"unfollowTopic",props:function(e){var t=e.ownProps,n=e.unfollowTopic;return{unfollowTopic:function(){return n({variables:{slug:t.topic.slug},optimisticResponse:{__typename:"Mutation",unfollowTopic:{__typename:"Topic",isFollowing:!1,slug:t.topic.slug}}})}}}}))((function(e){var t=e.topic,n=e.followTopic,r=e.unfollowTopic,o=e.size,i=void 0===o?"SMALL":o,a=e.shape,l=!!t.isFollowing;return u.createElement(R.c,{size:i,shape:a,buttonStyle:l?"STRONG":"OBVIOUS",onClick:l?r:n},l?"Following":"Follow")})),ye=n("./src/components/susi/SusiClickable.tsx");function _e(){var e=a()(["\n  fragment TopicFollowButtonSignedOut_topic on Topic {\n    id\n    slug\n    ...SusiClickable_topic\n  }\n  ","\n"]);return _e=function(){return e},e}var Le=p()(_e(),ye.d),Se=function(e){var t=e.topic,n=e.size,r=void 0===n?"SMALL":n,o=t.slug,i=t.id;return u.createElement(q.b,{source:{name:"topic_page",topicId:i,susiEntry:"follow_topicpage"}},u.createElement(ye.a,{actionUrl:o?Object(C.M)(o):"",buttonSize:r,buttonStyle:"SUBTLE",isButton:!0,operation:"register",topic:t},"Follow"))};function Ie(){var e=a()(["\n  fragment TopicLandingHeader_topic on Topic {\n    name\n    description\n    visibility\n    ...TopicFollowButtonSignedIn_topic\n    ...TopicFollowButtonSignedOut_topic\n  }\n  ","\n  ","\n"]);return Ie=function(){return e},e}function ke(e){var t=e.topic;if(!t)return null;var n="TOPIC_VISIBILITY_PUBLIC"===t.visibility;return u.createElement(u.Fragment,null,u.createElement(R.b,{sm:{display:"flex",justifyContent:"space-between"}},u.createElement(R.b,{sm:{marginRight:"32px"}},u.createElement(R.n,{clamp:2},t.name),u.createElement(R.b,{marginTop:"5px"},u.createElement(R.d,{clamp:2},t.description))),n&&u.createElement(R.b,{marginTop:"20px",sm:{marginTop:"0px"}},u.createElement(b.b,null,(function(e){return e?u.createElement(Pe,{topic:t}):u.createElement(Se,{topic:t})})))),n&&u.createElement(R.b,{marginTop:"23px",sm:{marginTop:"15px"}},u.createElement(R.d,null,"Follow to get great stories about ",t.name," in your inbox and on your homepage")))}var Fe=p()(Ie(),xe,Le);function Oe(){var e=a()(["\n  fragment TopicLandingPopular_posts on Topic {\n    name\n    popularPosts(paging: $sidebarPagingOptions) {\n      postPreviews {\n        post {\n          ...PostListingItemSidebar_post\n        }\n      }\n    }\n  }\n  ","\n"]);return Oe=function(){return e},e}var je=function(e){return e&&e.popularPosts&&e.popularPosts.postPreviews&&e.popularPosts.postPreviews.length>0};function Be(e){var t=e.topic;if(!je(t))return null;var n=t.popularPosts&&t.popularPosts.postPreviews||[];return u.createElement(R.b,{marginTop:"48px"},u.createElement(R.r,{tag:"h2"},"Popular in ",t.name),n.map((function(e){return e&&e.post?u.createElement(q.b,{key:e.post.id,source:{name:"topic_page",sectionType:q.a.MOST_POPULAR_STORIES_IN_TOPIC}},u.createElement(E.f,{post:e.post})):null})))}var Re=p()(Oe(),E.g);function Ae(){var e=a()(["\n  fragment TopicLandingRelatedTopics_topic on Topic {\n    relatedTopics {\n      topic {\n        name\n        slug\n      }\n    }\n  }\n"]);return Ae=function(){return e},e}var Me=p()(Ae()),We=Object(d.c)((function(e){return{authDomain:e.config.authDomain}}))((function(e){var t=e.authDomain,n=e.topic;if(!n||!n.relatedTopics||0===n.relatedTopics.length)return null;var r=n.relatedTopics;return u.createElement(u.Fragment,null,u.createElement(R.b,{marginTop:"48px"},u.createElement(R.r,{tag:"h2"},"Related topics")),r.map((function(e,n){if(!e.topic)return null;var r=e.topic,o=0===n;return u.createElement(R.b,{marginTop:o?"20px":"8px",key:r&&r.slug||void 0},u.createElement(R.f,{href:Object(C.Ib)(t,r.slug||"")},u.createElement(R.q,null,r.name)))})))})),Ce=n("./src/framework/reporter/index.ts"),De=n("./node_modules/react-helmet-async/lib/index.module.js"),Ue=n("./src/util/miroImage.ts");function Ne(){var e=a()(["\n  fragment TopicMetadata_topic on Topic {\n    name\n    description\n    slug\n    image {\n      id\n    }\n  }\n"]);return Ne=function(){return e},e}var He=Object(d.c)((function(e){var t=e.config;return{productName:t.productName,authDomain:t.authDomain}}))((function(e){var t=e.topic,n=e.productName,r=e.authDomain,o=t.name||"",i=t.description||"",a="".concat(o," - ").concat(n),l="".concat(o," on ").concat(n,": ").concat(i),s=t.image&&t.image.id?Object(Ue.d)({miroId:t.image.id,width:1200,strategy:Ue.a.Resample,height:NaN}):null,c=Object(C.Ib)(r,t.slug||"");return u.createElement(De.a,null,u.createElement("title",null,a),u.createElement("meta",{name:"title",content:a}),u.createElement("meta",{name:"description",content:l}),u.createElement("link",{rel:"canonical",href:c}),u.createElement("meta",{name:"twitter:card",content:"summary"}),u.createElement("meta",{name:"twitter:site",content:"@Medium"}),u.createElement("meta",{name:"twitter:description",content:l}),s?u.createElement("meta",{name:"twitter:image:src",content:s}):null,u.createElement("meta",{property:"og:title",content:a}),u.createElement("meta",{property:"og:type",content:"website"}),u.createElement("meta",{property:"og:description",content:l}),s?u.createElement("meta",{property:"og:image",content:s}):null)})),$e=p()(Ne());function Ge(){var e=a()(["\n  fragment TopicScreen_topic on Topic {\n    id\n    ...TopicMetadata_topic\n    ...TopicLandingHeader_topic\n    ...TopicFeaturedAndLatest_topic\n    ...TopicLandingRelatedTopics_topic\n    ...TopicLandingPopular_posts\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return Ge=function(){return e},e}var ze=function(e){function t(){return h()(this,t),L()(this,I()(t).apply(this,arguments))}return F()(t,e),y()(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.isLoggedIn,n=e.reporter,r=e.topic;n.event("topic.viewed",{topicId:r.id,topicSlug:r.slug}),t||Object(B.c)(r.id)}},{key:"render",value:function(){var e=this.props,t=e.topic,n=e.loading,r=e.fetchMore;return u.createElement(u.Fragment,null,u.createElement(O.a,null),u.createElement(He,{topic:t}),u.createElement(j.a,{topic:t}),u.createElement(R.w,null,u.createElement(R.k,{alignItems:"flex-start"},u.createElement(R.l,{size:{xs:12,sm:12,md:8,lg:8,xl:8}},u.createElement(R.b,{display:"none",sm:{display:"block",paddingBottom:"32px"}},u.createElement(ke,{topic:t})),u.createElement(me,{topic:t,loading:n,fetchMore:r})),u.createElement(R.l,{size:4},u.createElement(R.b,{marginLeft:"56px",lg:{marginLeft:"24px"},sm:{display:"none"}},u.createElement(ke,{topic:t}),u.createElement(We,{topic:t}),u.createElement(Be,{topic:t}))))))}}]),t}(u.Component),qe=Object(Ce.d)(ze),Ve=p()(Ge(),$e,Fe,de,Me,Re);function Je(){var e=a()(["\n  query TopicHandler(\n    $topicSlug: ID!\n    $feedPagingOptions: PagingOptions\n    $sidebarPagingOptions: PagingOptions\n  ) {\n    topic(slug: $topicSlug) {\n      canonicalSlug\n      ...TopicScreen_topic\n    }\n  }\n  ","\n  ","\n"]);return Je=function(){return e},e}var Qe=p()(Je(),E.c,Ve);t.default=Object(d.c)((function(e){return{authDomain:e.config.authDomain}}))((function(e){var t=e.authDomain,n=e.match;return u.createElement(m.b,{query:Qe,variables:{topicSlug:n.params.topicSlug,feedPagingOptions:{limit:10},sidebarPagingOptions:{limit:5}}},(function(e){var r,i,a=e.loading,l=e.error,c=e.fetchMore,p=e.data,m=void 0===p?{topic:void 0}:p;if(a)return u.createElement(w.a,null);if(l&&Object(g.a)(l))return u.createElement(x.a,null);if(l)return u.createElement(v.a,{error:l});if(!(null==m?void 0:m.topic))return u.createElement(x.a,null);if(m.topic.canonicalSlug)return u.createElement(f.a,{to:Object(C.Ib)(t,m.topic.canonicalSlug)});var d,E=m.topic,T=null==E?void 0:null===(r=E.latestPosts)||void 0===r?void 0:null===(i=r.pagingInfo)||void 0===i?void 0:i.next;if(T){var h={limit:T.limit,to:T.to};d=function(){return c({variables:{feedPagingOptions:h},updateQuery:function(e,t){var n,r,i,a,l,c,p=t.fetchMoreResult,u=s()(p),m=null!==(n=null==e?void 0:null===(r=e.topic)||void 0===r?void 0:null===(i=r.latestPosts)||void 0===i?void 0:i.postPreviews)&&void 0!==n?n:[],d=null!==(a=null==p?void 0:null===(l=p.topic)||void 0===l?void 0:null===(c=l.latestPosts)||void 0===c?void 0:c.postPreviews)&&void 0!==a?a:[];return u.topic.latestPosts.postPreviews=[].concat(o()(m),o()(d)),u}})}}return u.createElement(b.b,null,(function(e){var t=!!e;return u.createElement(qe,{topic:E,loading:a,fetchMore:d,key:n.params.topicSlug,isLoggedIn:t})}))}))}))}}]);
//# sourceMappingURL=screen.topic.5420b814.chunk.js.map